(function(e){WhereIsMyBlock.Form=function(){var i=this,s=e("div.ccm-dashboard-page-container"),k=e("div.ccm-pane-body");e("div#bodyOverlay");var o=e("div.ccm-pane-footer"),f=e("div#ccm-dashboard-content form#wimb"),r=e("img#ccm-wimb-loading"),j=f.find("select"),p=j.filter('select[name="btid"]'),t=j.filter('select[name="ipp"]'),l=f.find('input[name="sort_by"]'),m=f.find('input[name="sort_dir"]'),q=f.find('input[name="ccm_paging_p"]'),g=f.find('input[name="refresh"]'),u=f.find('input[name="ccm_token"]'),
d={};this.init=function(){f.on("submit",function(){g.val(1);i.submitForm();return!1});j.each(function(){e(this).on("change",function(){if(0<p.find(":selected").val().length){var a=e(this).is(p)?1:0;g.val(a);q.val(1);i.submitForm()}})});k.on("click","table#ccm-where-is-my-block th a",function(){var a=l.val(),c=m.val(),b=e(this).get(0).getAttribute("data-sort"),c="asc"==c?"desc":"asc";l.val(b);a==b&&m.val(c);g.val(0);i.submitForm()});o.on("click","div.ccm-pagination a",function(){var a=e(this),c=/ccm_paging_p=(\d+)/.exec(this.href);
c instanceof Array&&1<c.length?a=parseInt(c[1]):"..."==a.text()?(c=parseInt(a.parent().prev().find("a:first-child").text()),a=parseInt(a.parent().next().find("a:first-child").text()),a=Math.floor((c+a)/2)):a=1;q.val(a);g.val(0);i.submitForm();return!1})};this.submitForm=function(){r.show();e("div#ccm-dashboard-result-message").remove();k.find(".responseText").remove();d.btid=p.find(":selected").val();d.ipp=t.find(":selected").val();d.sort_by=l.val();d.sort_dir=m.val();d.ccm_paging_p=q.val();d.refresh=
g.val();d.ccm_token=u.val();var a="?",c;for(c in d)a+=c+"="+d[c]+"&";a=a.slice(0,a.length-1);e.get(WhereIsMyBlock.URL_TOOL_PAGE_BLOCK_SEARCH+a,i.parseResponse,"json")};this.parseResponse=function(a){a=a||{};k.find("table.ccm-results-list").remove();k.find("div.ccm-paging-top").remove();o.find("div.ccm-pagination").remove();if("success"===a.status&&a.response&&a.response.tblData&&a.response.tblData instanceof Array&&0<a.response.tblData.length){var c=a.response.tblData,b;b='<table border="0" cellspacing="0" cellpadding="0" id="ccm-where-is-my-block" class="ccm-results-list"><thead><tr>';
for(var d in c[0]){for(var f=l.val()==d?"ccm-results-list-active-sort-"+m.val():"",i=d.toString().replace(/_/g," ").replace(/-/g," ").replace(/\//g," ").split(" "),g="",h=0,n=i.length;h<n;h++)g+=i[h].charAt(0).toUpperCase()+i[h].slice(1),h+1!=n&&(g+=" ");b+='<th class="'+f+'"><a href="javascript:{};" data-sort="'+d+'">'+g+"</a></th>"}b+="</tr></thead><tbody>";h=0;for(n=c.length;h<n;h++){d=c[h];b+='<tr class="ccm-list-record'+(0!==h%2?" ccm-list-record-alt":"")+'">';for(var j in d)f=d[j].toString().replace(/&/g,
"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),b+="<td>",b+="page_path"==j?'<a href="'+CCM_BASE_URL+d[j]+'" target="_blank">'+f+"</a>":f,b+="</td>";b+="</tr>"}b+="</tbody></table>";c=a.response.pgnInfo;sPgn=a.response.pgnHtml;c&&0<c.length&&(b+='<div class="ccm-paging-top">'+c+"</div>");sPgn&&0<sPgn.length&&o.prepend(sPgn);k.prepend(b)}else if(a.alert&&0<a.alert.length&&(b=e(a.alert),b.css("display","block"),s.prepend(b)),a.message&&0<a.message.length)a=
e('<h5 class="responseText">'+a.message+"</h5>"),k.prepend(a);r.hide()}}})(jQuery);