(function(d){WhereIsMyBlock.Form=function(){var f=this,q=d("div#ccm-dashboard-content > div.container"),h=d("div.ccm-pane-body");d("div#bodyOverlay");var l=d("div.ccm-pane-footer"),e=d("div#ccm-dashboard-content form#wimb"),p=e.find('input[type="submit"]');$loader=void 0;$select=e.find("select");$btidSelect=$select.filter('select[name="btid"]');$ippSelect=$select.filter('select[name="ipp"]');$sortInput=e.find('input[name="sort_by"]');$dirInput=e.find('input[name="sort_dir"]');$pagingInput=e.find('input[name="ccm_paging_p"]');
$refreshInput=e.find('input[name="refresh"]');$tokenInput=e.find('input[name="ccm_token"]');oQueryVars={};bIsAjaxing=!1;this.init=function(){$loader=d('<div id="ccm-dialog-loader-wrapper" class="ccm-ui"><img id="ccm-dialog-loader" src="'+CCM_IMAGE_PATH+'/throbber_white_32.gif" /></div>');d("body").append($loader);e.on("submit",function(){$refreshInput.val(1);f.submitForm();return!1});$select.each(function(){d(this).on("change",function(){if(0<$btidSelect.find(":selected").val().length){var a=d(this).is($btidSelect)?
1:0;$refreshInput.val(a);$pagingInput.val(1);f.submitForm()}})});h.on("click","table#ccm-where-is-my-block th a",function(){if(!1!==bIsAjaxing)return!1;var a=$sortInput.val(),c=$dirInput.val(),b=d(this).get(0).getAttribute("data-sort"),c="asc"==c?"desc":"asc";$sortInput.val(b);a==b&&$dirInput.val(c);$refreshInput.val(0);f.submitForm()});l.on("click","div.ccm-pagination a",function(){var a=d(this),c=/ccm_paging_p=(\d+)/.exec(this.href);if(a.parent().hasClass("disabled")||!1!==bIsAjaxing)return!1;c instanceof
Array&&1<c.length?a=parseInt(c[1]):"..."==a.text()?(c=parseInt(a.parent().prev().find("a:first-child").text()),a=parseInt(a.parent().next().find("a:first-child").text()),a=Math.floor((c+a)/2)):a=1;$pagingInput.val(a);$refreshInput.val(0);f.submitForm();return!1});""!=$btidSelect.find(":selected").val()&&($refreshInput.val(0),f.submitForm())};this.submitForm=function(){if(!0===bIsAjaxing)return!1;bIsAjaxing=!0;p.attr("disabled","disabled");$btidSelect.attr("disabled","disabled");$ippSelect.attr("disabled",
"disabled");$loader.show();var a=d("table#ccm-where-is-my-block");a.length&&a.css({opacity:0.4});d("div#ccm-dashboard-result-message").remove();h.find(".responseText").remove();oQueryVars.btid=$btidSelect.find(":selected").val();oQueryVars.ipp=$ippSelect.find(":selected").val();oQueryVars.sort_by=$sortInput.val();oQueryVars.sort_dir=$dirInput.val();oQueryVars.ccm_paging_p=$pagingInput.val();oQueryVars.refresh=$refreshInput.val();oQueryVars.ccm_token=$tokenInput.val();var a="?",c;for(c in oQueryVars)a+=
c+"="+oQueryVars[c]+"&";a=a.slice(0,a.length-1);d.get(WhereIsMyBlock.URL_TOOL_PAGE_BLOCK_SEARCH+a,f.parseResponse,"json")};this.parseResponse=function(a){a=a||{};h.find("table.ccm-results-list").remove();h.find("div.ccm-paging-top").remove();l.find("div.ccm-pagination").remove();if("success"===a.status&&a.response&&a.response.tblData&&a.response.tblData instanceof Array&&0<a.response.tblData.length){var c=a.response.tblData,b;b='<table border="0" cellspacing="0" cellpadding="0" id="ccm-where-is-my-block" class="ccm-results-list"><thead><tr>';
for(var e in c[0]){for(var f=$sortInput.val()==e?"ccm-results-list-active-sort-"+$dirInput.val():"",m=e.toString().replace(/_/g," ").replace(/-/g," ").replace(/\//g," ").split(" "),j="",g=0,k=m.length;g<k;g++)j+=m[g].charAt(0).toUpperCase()+m[g].slice(1),g+1!=k&&(j+=" ");b+='<th class="'+f+'"><a href="javascript:{};" data-sort="'+e+'">'+j+"</a></th>"}b+="</tr></thead><tbody>";g=0;for(k=c.length;g<k;g++){e=c[g];b+='<tr class="ccm-list-record'+(0!==g%2?" ccm-list-record-alt":"")+'">';for(var n in e)f=
e[n].toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),b+="<td>",b+="page_path"==n?'<a href="'+e[n]+'" target="_blank">'+f+"</a>":f,b+="</td>";b+="</tr>"}b+="</tbody></table>";c=a.response.pgnInfo;a=a.response.pgnHtml;c&&0<c.length&&(b+='<div class="ccm-paging-top">'+c+"</div>");a&&0<a.length&&l.prepend(a);h.prepend(b)}else a.alert&&0<a.alert.length&&(b=d(a.alert),b.css("display","block"),q.prepend(b)),a.message&&0<a.message.length&&
(a=d('<h5 class="responseText">'+a.message+"</h5>"),h.prepend(a));p.removeAttr("disabled");$btidSelect.removeAttr("disabled");$ippSelect.removeAttr("disabled");$loader.hide();bIsAjaxing=!1}}})(jQuery);